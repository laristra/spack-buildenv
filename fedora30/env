FROM laristra/spack-base:fedora30_tmp

SHELL ["/bin/bash", "-c"]

ENV DEBIAN_FRONTEND=noninteractive \
    HOME=/home/flecsi \
    BASH_ENV=~/.bashrc

USER flecsi
WORKDIR $HOME

RUN spack install --show-log-on-error --only dependencies flecsi%gcc +cinch backend=mpi +hdf5 +caliper ^mpich && \
    spack install --show-log-on-error --only dependencies flecsi%gcc +cinch backend=mpi +hdf5 +caliper ^openmpi && \
    spack clean --all

ENTRYPOINT ["entrypoint.sh"]
CMD ["/bin/bash"]
